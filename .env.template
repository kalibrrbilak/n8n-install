# ============================================================
# n8n v2+ Полная конфигурация
# Этот файл создается автоматически при установке
# ============================================================

# ============================================================
# ДОМЕНЫ (обязательно настроить DNS A-записи!)
# ============================================================
DOMAIN=n8n.example.ru
PGADMIN_DOMAIN=pgadmin.example.ru
REDIS_DOMAIN=redis.example.ru

# ============================================================
# SSL СЕРТИФИКАТЫ
# ============================================================
EMAIL=admin@example.ru

# ============================================================
# POSTGRESQL
# ============================================================
POSTGRES_USER=n8n
POSTGRES_PASSWORD=<автогенерируется при установке>
POSTGRES_DB=n8n

# ============================================================
# PGADMIN (UI для PostgreSQL)
# Доступ: https://pgadmin.example.ru
# ============================================================
PGADMIN_EMAIL=admin@example.ru
PGADMIN_PASSWORD=<автогенерируется при установке>

# ============================================================
# REDIS
# ============================================================
REDIS_PASSWORD=<автогенерируется при установке>

# Redis Commander UI (HTTP Basic Auth)
# Доступ: https://redis.example.ru
REDIS_UI_USER=admin
REDIS_UI_PASSWORD=<автогенерируется при установке>

# ============================================================
# N8N - ОСНОВНЫЕ НАСТРОЙКИ
# ============================================================
# Версия n8n (фиксированная, НЕ latest!)
N8N_VERSION=1.74.2

N8N_ENCRYPTION_KEY=<автогенерируется при установке - 64 символа hex>
WEBHOOK_URL=https://${DOMAIN}/

# ============================================================
# N8N - BINARY DATA MODE
# Где хранить файлы: filesystem (на диске) или database (в БД)
# Рекомендуется: filesystem для лучшей производительности
# ============================================================
N8N_BINARY_DATA_MODE=filesystem
N8N_DEFAULT_BINARY_DATA_MODE=filesystem

# ============================================================
# N8N - PROXY SETTINGS (для Traefik)
# ВАЖНО: для корректной работы с reverse proxy
# ============================================================
N8N_EXPRESS_TRUST_PROXY=true
N8N_TRUSTED_PROXIES=*
N8N_PROXY_HOPS=1

# ============================================================
# N8N - BASIC AUTH (дополнительная защита)
# Если включить, будет запрашивать логин/пароль ДО входа в n8n
# ============================================================
N8N_BASIC_AUTH_ACTIVE=false
# N8N_BASIC_AUTH_USER=admin
# N8N_BASIC_AUTH_PASSWORD=<пароль>

# ============================================================
# ВНЕШНИЙ PROXY (для n8n запросов наружу)
# Если n8n должен ходить в интернет через прокси
# Формат: http://user:pass@proxy-server:port
# ============================================================
PROXY_URL=

# Исключения для прокси (внутренние адреса Docker)
# ВАЖНО: эти адреса НЕ должны ходить через прокси
NO_PROXY=localhost,127.0.0.1,::1,.local,postgres,redis,pgadmin,traefik,n8n,n8n-postgres,n8n-redis,n8n-pgadmin,n8n-redis-commander,n8n-traefik

# Если используете прокси для конкретных сайтов, добавьте их в NO_PROXY:
# NO_PROXY=...,instagram.com,vk.com,.vk.com,api.vk.com,userapi.com

# ============================================================
# TELEGRAM BOT
# ============================================================
TG_BOT_TOKEN=<получить от @BotFather>
TG_USER_ID=<ваш Telegram User ID>

# Как получить:
# 1. Bot Token: напишите @BotFather -> /newbot -> следуйте инструкциям
# 2. User ID: напишите @userinfobot -> скопируйте ваш ID

# ============================================================
# РЕЗЕРВНОЕ КОПИРОВАНИЕ
# ============================================================
BACKUP_RETENTION_DAYS=7
BACKUP_SCHEDULE="0 2 * * *"

# ============================================================
# TIMEZONE (Екатеринбург)
# ============================================================
GENERIC_TIMEZONE=Asia/Yekaterinburg
TZ=Asia/Yekaterinburg

# ============================================================
# N8N - ДОПОЛНИТЕЛЬНЫЕ НАСТРОЙКИ
# ============================================================
N8N_METRICS=true
N8N_LOG_LEVEL=info
N8N_DIAGNOSTICS_ENABLED=false
N8N_PERSONALIZATION_ENABLED=false

# ============================================================
# N8N 2.X - БЕЗОПАСНОСТЬ ФАЙЛОВОЙ СИСТЕМЫ
# ============================================================
# Включить Execute Command и Local File Trigger (по умолчанию отключены в n8n 2.x)
NODES_EXCLUDE=[]

# Whitelist путей для Read/Write Binary Files нод
# /home/node/.n8n-files - стандартная sandbox-зона n8n v2
# /data - кастомная рабочая папка проекта
# ВАЖНО: разделитель строго ; (точка с запятой)
N8N_RESTRICT_FILE_ACCESS_TO=/home/node/.n8n-files;/data

# ============================================================
# N8N 2.X - TASK RUNNERS
# ============================================================
# Включить изолированные task runners для выполнения кода
# true = выполнение в изолированных процессах (безопаснее)
# false = выполнение в основном процессе (быстрее, меньше памяти)
N8N_RUNNERS_ENABLED=false

# ============================================================
# QUEUE MODE (для высокой производительности)
# ============================================================
EXECUTIONS_MODE=queue
QUEUE_BULL_REDIS_HOST=n8n-redis
QUEUE_BULL_REDIS_PORT=6379
